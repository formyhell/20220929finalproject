<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.admin.stats.dao.AdminStatsDAO">

	<select id="selectGenJoinList" resultType="Map">
		SELECT COUNT(A.GEN_ID) M_ALLCOUNT, TO_CHAR(A.GEN_JOINDATE, 'YYYY/MM')
		M_DATE, B.M_DELCOUNT,
		SUM(COUNT(A.GEN_ID)) OVER(ORDER BY TO_CHAR(A.GEN_JOINDATE, 'YYYY/MM'))-NVL(B.M_DELCOUNT,0)
		M_SUM
		FROM GEN_MEMBER A LEFT JOIN (SELECT COUNT(GEN_ID) M_DELCOUNT,
		TO_CHAR(GEN_DELETEDATE, 'YYYY/MM') M_DATE
		FROM GEN_MEMBER
		WHERE GEN_DELETE = 1
		GROUP BY TO_CHAR(GEN_DELETEDATE, 'YYYY/MM')) B
		ON( TO_CHAR(A.GEN_JOINDATE, 'YYYY/MM') = B.M_DATE)
		GROUP BY TO_CHAR(A.GEN_JOINDATE, 'YYYY/MM'), B.M_DELCOUNT
	</select>

	<select id="selectComJoinList" resultType="Map">
		SELECT COUNT(A.COM_ID) M_ALLCOUNT, TO_CHAR(A.COM_JOINDATE, 'YYYY/MM')
		M_DATE, B.M_DELCOUNT,
		SUM(COUNT(A.COM_ID)) OVER(ORDER BY TO_CHAR(A.COM_JOINDATE, 'YYYY/MM'))-NVL(B.M_DELCOUNT,0)
		M_SUM
		FROM COM_MEMBER A LEFT JOIN (SELECT COUNT(COM_ID) M_DELCOUNT,
		TO_CHAR(COM_DELETEDATE, 'YYYY/MM') M_DATE
		FROM COM_MEMBER
		WHERE COM_DELETE = 1
		GROUP BY TO_CHAR(COM_DELETEDATE, 'YYYY/MM')) B
		ON( TO_CHAR(A.COM_JOINDATE, 'YYYY/MM') = B.M_DATE)
		GROUP BY TO_CHAR(A.COM_JOINDATE, 'YYYY/MM'), B.M_DELCOUNT
	</select>

	<select id="selectSkillList" resultType="Map">
		SELECT COUNT(A.GEN_ID) S_COUNT, A.SKILL_CODE S_CODE, B.CODE_NAME S_NAME
		FROM GEN_SKILL A INNER JOIN COMMON_CODE B ON (B.CODE_ID = A.SKILL_CODE)
		GROUP BY A.SKILL_CODE, B.CODE_NAME
	</select>

	<select id="selectOutProjList" resultType="Map">
		SELECT COUNT(PROJ_ID) P_COUNT, TO_CHAR(PROJ_RECRUITSDATE, 'YYYY/MM') P_DATE
		FROM OUTSOURCING_PROJ
		GROUP BY TO_CHAR(PROJ_RECRUITSDATE, 'YYYY/MM')
	</select>

	<select id="selectPmsProjList" resultType="Map">
		SELECT COUNT(PROJ_ID) P_COUNT, TO_CHAR(PROJ_SDATE, 'YYYY/MM') P_DATE
		FROM PMSPROJ
		GROUP BY TO_CHAR(PROJ_SDATE, 'YYYY/MM')
	</select>
	
	<select id="selectTop" resultType="Map">
		SELECT *
		FROM (SELECT NVL(TO_CHAR(SUM(PAY_PRICE), 'fm999,999,999,999'),0) T_PAY
		        FROM PAY),
		     (SELECT NVL(TO_CHAR(COUNT(PROJ_ID), 'fm999,999,999,999'),0) T_OUTPJ
		        FROM OUTSOURCING_PROJ
		        WHERE PROJ_STATE != 'DELETE'
		        AND PROJ_APPROVE = 1),  
		     (SELECT NVL(TO_CHAR(COUNT(CMNT_NO), 'fm999,999,999,999'),0 ) T_COMMU
		        FROM COMMUNITY
		        WHERE CMNT_STATE = 'Y'),  
		     (SELECT NVL(TO_CHAR((A.M_COUNT+B.M_COUNT), 'fm999,999,999,999'),0) T_MEM
		        FROM (SELECT COUNT(GEN_ID) M_COUNT
		                FROM GEN_MEMBER
		                WHERE GEN_DELETE = 0) A,
		              (SELECT COUNT(COM_ID) M_COUNT
		                FROM COM_MEMBER 
		                WHERE COM_DELETE = 0) B  )
	</select>
	
	<select id="selectTrep" resultType="Map">
		SELECT NVL(TO_CHAR(COUNT(CMNT_NO), 'fm999,999,999,999'),0) TREP
		FROM COMMUNITY
		WHERE CMNT_REPORT > 0
	</select>


</mapper>